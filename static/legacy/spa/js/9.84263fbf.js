(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[9],{"6ce6":function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("q-page",{staticClass:"q-pt-md"},[n("q-btn",{attrs:{label:"Изменить поля"},on:{click:function(e){t.is_edit_fields=!0}}}),n("q-table",{attrs:{data:t.students,columns:t.columns,"row-key":"id","visible-columns":t.visibleColumns},scopedSlots:t._u([{key:"body-cell-edit",fn:function(e){return[n("q-td",{attrs:{props:e}},[n("q-btn",{attrs:{dense:""},on:{click:function(n){return t.editStudent(e.row)}}},[t._v("Edit")])],1)]}},{key:"body-cell-photo",fn:function(t){return[n("q-td",{attrs:{props:t}},[n("q-avatar",[n("q-img",{attrs:{src:t.row.avatar}})],1)],1)]}},{key:"body-cell-document_photo",fn:function(e){return[n("q-td",{attrs:{props:e}},[n("q-btn",{attrs:{dense:"","no-wrap":"",flat:""}},[e.row.student?n("q-avatar",{on:{click:function(n){return t.openPreview(e.row)}}},[n("q-img",{attrs:{src:e.row.student.document_avatar}})],1):t._e()],1)],1)]}}])}),n("q-dialog",{attrs:{persistent:""},model:{value:t.is_edit,callback:function(e){t.is_edit=e},expression:"is_edit"}},[n("q-card",[n("q-card-section",[n("div",{staticClass:"text-h6"},[t._v("Редактирование студента")])]),n("q-card-section",{staticClass:"q-pt-none"},t._l(t.fields,(function(e,a){return n("q-input",{key:a,attrs:{label:e.fieldLabel},model:{value:t.editStudentData.student[e.fieldName],callback:function(n){t.$set(t.editStudentData.student,e.fieldName,n)},expression:"editStudentData.student[field.fieldName]"}})})),1),n("q-card-actions",{attrs:{align:"right"}},[n("q-btn",{attrs:{flat:"",label:"Сохранить",color:"primary"},on:{click:t.saveStudent}}),n("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Закрыть",color:"primary"}})],1)],1)],1),n("q-dialog",{attrs:{persistent:""},model:{value:t.is_edit_fields,callback:function(e){t.is_edit_fields=e},expression:"is_edit_fields"}},[n("q-card",[n("q-card-section",[n("div",{staticClass:"text-h6"},[t._v("Редактирование полей")])]),n("q-card-section",{staticClass:"q-pt-none"},[t._l(t.fields,(function(e,a){return n("div",{key:a,staticClass:"flex"},[n("q-select",{attrs:{label:"Тип поля",options:[{value:"string",label:"Строка"}],"map-options":"","emit-value":""},model:{value:e.fieldType,callback:function(n){t.$set(e,"fieldType",n)},expression:"field.fieldType"}}),n("q-input",{attrs:{label:"Служебное имя"},model:{value:e.fieldName,callback:function(n){t.$set(e,"fieldName",n)},expression:"field.fieldName"}}),n("q-input",{attrs:{label:"Название поля"},model:{value:e.fieldLabel,callback:function(n){t.$set(e,"fieldLabel",n)},expression:"field.fieldLabel"}}),n("q-btn",{attrs:{icon:"delete"},on:{click:function(e){return t.fields.splice(a,1)}}})],1)})),n("q-btn",{attrs:{icon:"add",label:"Добавить поле"},on:{click:function(e){return t.fields.push({fieldType:"",fieldName:"",fieldLabel:""})}}})],2),n("q-card-actions",{attrs:{align:"right"}},[n("q-btn",{attrs:{flat:"",label:"Сохранить",color:"primary"},on:{click:t.saveFields}}),n("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Закрыть",color:"primary"}})],1)],1)],1),n("q-dialog",{model:{value:t.is_photo_preview,callback:function(e){t.is_photo_preview=e},expression:"is_photo_preview"}},[t.is_photo_preview?n("q-card",[n("q-card-section",[n("div",{staticClass:"text-h6"},[t._v("\n          "+t._s(t.activeStudent.contingent.surname)+"\n          "+t._s(t.activeStudent.contingent.name)+"\n          "+t._s(t.activeStudent.contingent.secname)+"\n        ")])]),n("q-card-section",{staticClass:"q-pt-none"},[n("q-img",{attrs:{src:t.activeStudent.student.document_avatar}})],1),n("q-card-actions",{attrs:{align:"right"}},[n("q-btn",{attrs:{flat:"",label:"Скачать",color:"primary",target:"_blank"},on:{click:function(e){return t.downloadFile(t.activeStudent.student.document_avatar,t.activeStudent.contingent.surname+" "+t.activeStudent.contingent.name+" "+t.activeStudent.contingent.secname)}}}),n("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Закрыть",color:"primary"}})],1)],1):t._e()],1)],1)},i=[],s=(n("6b54"),n("06db"),n("7f7f"),n("4db1")),l=n.n(s),o=(n("f751"),n("967e")),d=n.n(o),r=(n("96cf"),n("fa84")),c=n.n(r),u={name:"Index",components:{},data:function(){return{is_edit_fields:!1,is_photo_preview:!1,activeStudent:{},students:[],fields:[],editStudentData:{student:{}},is_edit:!1}},methods:{updateStudents:function(){var t=this;return c()(d.a.mark((function e(){var n,a;return d.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$axios("/group/students");case 2:return n=e.sent,t.students=n.data,e.next=6,t.$axios("/group/fields");case 6:a=e.sent,t.fields=a.data;case 8:case"end":return e.stop()}}),e)})))()},editStudent:function(t){var e=JSON.parse(JSON.stringify(t));e.student||(e.student={}),this.editStudentData=e,this.is_edit=!0},saveStudent:function(){var t=this;return c()(d.a.mark((function e(){return d.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.$axios.put("/students/student/".concat(t.editStudentData.id),Object.assign({},t.editStudentData.student,{userId:String(t.editStudentData.id)})).then((function(){t.is_edit=!1,t.updateStudents()}));case 1:case"end":return e.stop()}}),e)})))()},openPreview:function(t){this.activeStudent=t,this.is_photo_preview=!0},downloadFile:function(t,e){var n=window.document.createElement("a");n.target="_blank",n.download=e,n.href=t,window.document.body.appendChild(n),n.click(),window.document.body.removeChild(n)},saveFields:function(){var t=this;this.$axios.put("/students/fields",this.fields).then((function(){t.is_edit_fields=!1,t.updateStudents()}))}},computed:{columns:function(){return[{name:"id",align:"left",label:"ID",field:"id",sortable:!0},{name:"fio",align:"left",label:"ФИО",field:function(t){return"".concat(t.contingent.surname," ").concat(t.contingent.name," ").concat(t.contingent.secname)},sortable:!0},{name:"login",align:"left",label:"СтудБилет",field:function(t){return t.contingent.login},sortable:!0},{name:"birthday",align:"left",label:"Дата рождения",field:function(t){return t.contingent.birthday},sortable:!0},{name:"corp_email",align:"left",label:"Бауманская почта",field:function(t){return t.login+"@student.bmstu.ru"},sortable:!0}].concat(l()(this.fields.map((function(t){return{name:t.fieldName,align:"left",label:t.fieldLabel,field:function(e){return e.student?e.student[t.fieldName]:null},sortable:!0}}))),[{name:"edit",align:"left",label:"edit",field:"",sortable:!1}])},isLeader:function(){return this.$store.getters["user/isLeader"]},date:function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(){return date}))},created:function(){this.updateStudents()},destroyed:function(){},watch:{}},f=u,p=(n("b5f0"),n("2877")),b=n("9989"),m=n("9c40"),v=n("eaac"),_=n("db86"),g=n("cb32"),q=n("068f"),h=n("24e8"),w=n("f09f"),S=n("a370"),k=n("27f9"),y=n("4b7e"),x=n("ddd8"),C=n("7f67"),N=n("eebe"),Q=n.n(N),D=Object(p["a"])(f,a,i,!1,null,"31c95ca2",null);e["default"]=D.exports;Q()(D,"components",{QPage:b["a"],QBtn:m["a"],QTable:v["a"],QTd:_["a"],QAvatar:g["a"],QImg:q["a"],QDialog:h["a"],QCard:w["a"],QCardSection:S["a"],QInput:k["a"],QCardActions:y["a"],QSelect:x["a"]}),Q()(D,"directives",{ClosePopup:C["a"]})},b5f0:function(t,e,n){"use strict";var a=n("ea46"),i=n.n(a);i.a},ea46:function(t,e,n){}}]);