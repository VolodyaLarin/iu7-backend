(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[5],{5446:function(t,e,n){"use strict";var a=n("cda5"),r=n.n(a);r.a},ab04:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("q-page",{directives:[{name:"touch-swipe",rawName:"v-touch-swipe.left.right",value:t.swipe,expression:"swipe",modifiers:{left:!0,right:!0}}],staticClass:"q-pt-md"},[n("div",[n("div",{staticClass:"text-center full-width q-pb-md"},[n("q-btn-group",{staticStyle:{"max-width":"100%"},attrs:{rounded:""}},[n("q-btn",{attrs:{color:"primary",rounded:"",icon:"navigate_before"},on:{click:t.prevDay}}),n("q-btn",{staticStyle:{width:"220px","max-width":"100%"},attrs:{color:"primary",rounded:"","no-caps":"",label:t.date.formatDate(t.selectedDay,"dddd, DD.MM.YYYY г")}},[n("q-popup-proxy",{attrs:{"transition-show":"scale","transition-hide":"scale"}},[n("q-date",{model:{value:t.selectedDay,callback:function(e){t.selectedDay=e},expression:"selectedDay"}},[n("div",{staticClass:"row items-center justify-end"},[n("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"Close",color:"primary",flat:""}})],1)])],1)],1),n("q-btn",{attrs:{color:"primary",rounded:"",icon:"navigate_next"},on:{click:t.nextDay}})],1)],1),n("q-pull-to-refresh",{on:{refresh:t.refresh}},[n("div",{staticClass:"row full-width events-container"},[t.loaded?t._e():n("div",{staticClass:"full-width text-center q-pa-lg"},[n("q-spinner",{attrs:{color:"primary",size:"5em"}})],1),t._l(t.sortedEvents,(function(e){return t.loaded?n("event",{key:e.id,staticClass:"q-ma-sm",staticStyle:{width:"600px"},attrs:{time:t.time,event:e,students:t.students},on:{edit:t.editEvent,update:t.update}}):t._e()})),t.loaded&&!t.events.length?n("q-banner",{staticClass:"bg-primary text-white q-ma-md",staticStyle:{width:"400px"},scopedSlots:t._u([{key:"avatar",fn:function(){return[n("q-icon",{attrs:{name:"weekend",color:"white"}})]},proxy:!0},t.isLeader?{key:"action",fn:function(){return[n("q-btn",{attrs:{flat:"",color:"white",label:"Синхронизировать этот день"},on:{click:t.syncRaspThisDay}})]},proxy:!0}:null],null,!0)},[t._v("\n                    Мероприятий пока нет.\n                    \n\n                    ")]):t._e()],2)])],1),t.isLeader?n("q-page-sticky",{attrs:{position:"bottom-right",offset:[18,18]}},[n("q-fab",{attrs:{"vertical-actions-align":"right",color:"primary",icon:"more_vert",direction:"up"}},[n("q-fab-action",{attrs:{color:"primary",to:{name:"group.table"},icon:"table_view"}},[n("q-tooltip",{attrs:{anchor:"center left",self:"center right"}},[t._v("\n                    Сводная ведомость\n                ")])],1),n("q-fab-action",{attrs:{color:"primary",to:{name:"group.students"},icon:"groups"}},[n("q-tooltip",{attrs:{anchor:"center left",self:"center right"}},[t._v("\n                    Карточки студентов\n                ")])],1),n("q-fab-action",{attrs:{color:"primary",icon:"sync"},on:{click:t.syncRaspDateWrapper}},[n("q-tooltip",{attrs:{anchor:"center left",self:"center right"}},[t._v("\n                    Синхронизация с BBMSTU\n                ")])],1),n("q-fab-action",{attrs:{color:"primary",icon:"add"},on:{click:t.addEvent}},[n("q-tooltip",{attrs:{anchor:"center left",self:"center right"}},[t._v("\n                    Добавить мероприятие\n                ")])],1)],1)],1):t._e(),n("q-dialog",{model:{value:t.addingEvent,callback:function(e){t.addingEvent=e},expression:"addingEvent"}},[n("add-event",{on:{created:t.createdEvent}})],1),n("q-dialog",{model:{value:t.editingEvent,callback:function(e){t.editingEvent=e},expression:"editingEvent"}},[n("edit-event",{attrs:{event:t.eventForEdit},on:{edited:t.editedEvent}})],1)],1)},r=[],i=n("967e"),s=n.n(i),o=(n("96cf"),n("fa84")),c=n.n(o),d=(n("ac6a"),n("cadf"),n("06db"),n("5df3"),n("f400"),n("bd4c")),u=n("3c89"),l=n("aaa5"),p=n("b275"),f=(n("758b"),n("22ad"));var v={name:"Index",components:{Event:p["a"],AddEvent:u["a"],EditEvent:l["a"],Task:f["a"]},data:function(){return{addingEvent:!1,time:new Date,timer:null,time_fix:0,editingEvent:!1,eventForEdit:{},tasks:[],loaded:!1,selectedDay:null,events:[],students:[]}},methods:{nextDay:function(){this.selectedDay=d["b"].formatDate(d["b"].addToDate(this.selectedDay,{days:1}),"YYYY/MM/DD")},prevDay:function(){this.selectedDay=d["b"].formatDate(d["b"].subtractFromDate(this.selectedDay,{days:1}),"YYYY/MM/DD")},update:function(){var t=this;return c()(s.a.mark((function e(){var n;return s.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.selectedDay){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,t.$axios("group/events/"+d["b"].formatDate(t.selectedDay,"YYYY-MM-DD")+"/visits");case 4:return n=e.sent,t.events=n.data,t.loaded=!0,e.abrupt("return");case 8:case"end":return e.stop()}}),e)})))()},addEvent:function(){this.addingEvent=!0},createdEvent:function(){this.update(),this.addingEvent=!1,this.$q.notify("Событие создано")},syncRaspDate:function(t){var e=this;return c()(s.a.mark((function n(){return s.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.$axios.post("/group/events/".concat(t,"/sync"));case 2:n.sent,e.$q.notify("Синхронизировано!"),e.update();case 5:case"end":return n.stop()}}),n)})))()},syncRaspThisDay:function(){var t=this;return c()(s.a.mark((function e(){return s.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.loaded=!1,e.next=3,t.syncRaspDate(d["b"].formatDate(t.selectedDay,"YYYY-MM-DD"));case 3:case"end":return e.stop()}}),e)})))()},syncRaspDateWrapper:function(){this.$q.dialog({title:"Синхронизация",message:"Введите дату для синхронизации (в формате 2020-09-24)",prompt:{model:"",isValid:function(t){return 10==t.length},type:"date"},cancel:!0,persistent:!0}).onOk(this.syncRaspDate)},editEvent:function(t){this.editingEvent=!0,this.eventForEdit=t},editedEvent:function(){this.editingEvent=!1,this.$q.notify("Событие изменено"),this.update()},syncTime:function(){var t=this;return c()(s.a.mark((function e(){return s.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.time_fix=0,t.selectedDay=d["b"].formatDate(new Date,"YYYY/MM/DD");case 2:case"end":return e.stop()}}),e)})))()},swipe:function(t){"right"==t.direction&&this.prevDay(),"left"==t.direction&&this.nextDay()},refresh:function(t){var e=this;return c()(s.a.mark((function n(){return s.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.update();case 2:t();case 3:case"end":return n.stop()}}),n)})))()},loadStudents:function(){var t=this;return c()(s.a.mark((function e(){var n;return s.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$axios("/group/students");case 2:n=e.sent,t.students=n.data;case 4:case"end":return e.stop()}}),e)})))()}},computed:{isLeader:function(){return this.$store.getters["user/isLeader"]},date:function(){return d["b"]},sortedEvents:function(){return this.events.sort((function(t,e){return t.date-e.date}))}},created:function(){var t=this;this.syncTime(),this.update(),this.loadStudents(),this.timer=setInterval((function(){t.time=new Date((new Date).getTime()+t.time_fix)}),1e3)},destroyed:function(){clearInterval(this.timer)},watch:{selectedDay:function(){this.loaded=!1,this.update()}}},h=v,m=(n("5446"),n("2877")),y=n("9989"),w=n("e7a9"),D=n("9c40"),b=n("7cbe"),g=n("52ee"),x=n("59d7"),q=n("0d59"),E=n("54e1"),k=n("0016"),Y=n("de5e"),_=n("c294"),Q=n("72db"),M=n("05c0"),S=n("24e8"),T=n("12c5"),C=n("7f67"),$=n("eebe"),R=n.n($),F=Object(m["a"])(h,a,r,!1,null,"929d9a08",null);e["default"]=F.exports;R()(F,"components",{QPage:y["a"],QBtnGroup:w["a"],QBtn:D["a"],QPopupProxy:b["a"],QDate:g["a"],QPullToRefresh:x["a"],QSpinner:q["a"],QBanner:E["a"],QIcon:k["a"],QPageSticky:Y["a"],QFab:_["a"],QFabAction:Q["a"],QTooltip:M["a"],QDialog:S["a"]}),R()(F,"directives",{TouchSwipe:T["a"],ClosePopup:C["a"]})},cda5:function(t,e,n){}}]);