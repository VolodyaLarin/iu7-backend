(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[15],{"72d9":function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("q-page",{staticClass:"q-pa-lg"},[n("q-item",[n("q-item-section",[n("q-item-label",[n("p",{staticClass:"text-h1"},[e._v("Категории: ")])])],1)],1),n("q-btn",{attrs:{label:"Создать новую категорию","no-caps":"",color:"positive"},on:{click:e.createCategory}}),e.TreeCategories.length?n("q-tree",{attrs:{nodes:e.TreeCategories,"node-key":"id","default-expand-all":"",dense:"",selected:""},scopedSlots:e._u([{key:"default-header",fn:function(t){return[n("div",{staticClass:"row items-center"},[n("q-btn-group",{attrs:{flat:""}},[n("q-btn",{attrs:{icon:"arrow_upward",flat:"",dense:"",size:"sm"},on:{click:function(n){return e.moveItemUp(t.node)}}}),n("q-btn",{attrs:{icon:"arrow_downward",flat:"",dense:"",size:"sm"},on:{click:function(n){return e.moveItemDown(t.node)}}})],1),n("q-icon",{staticClass:"q-mr-sm",attrs:{name:t.node.is_post?"book":"folder",color:"accent",size:"sm"}}),n("div",{staticClass:"q-mr-sm"},[e._v(e._s(t.node.title)+"\n                    "),n("q-btn-dropdown",{attrs:{"dropdown-icon":"edit",flat:"",dense:"",size:"sm","no-wrap":"",fab:""}},[n("q-list",[t.node.is_post?e._e():n("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(n){return e.editCategoryTitle(t.node)}}},[n("q-item-section",[n("q-item-label",[e._v("Изменить название")])],1)],1),t.node.is_post?e._e():n("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(n){return e.editCategoryParent(t.node)}}},[n("q-item-section",[n("q-item-label",[e._v("Изменить родителя")])],1)],1),t.node.is_post?n("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(n){return e.editPost(t.node)}}},[n("q-item-section",[n("q-item-label",[e._v("Изменить запись\n                                        "),n("q-icon",{attrs:{name:"open_in_new",color:"dark"}})],1)],1)],1):e._e()],1)],1)],1)],1)]}}],null,!1,3545064457)}):e._e()],1)},i=[],a=n("4db1"),o=n.n(a),s=(n("20d6"),n("7514"),n("a481"),n("967e")),c=n.n(s),l=(n("96cf"),n("fa84")),u=n.n(l),d={name:"Categories",data:function(){return{categories:{selected:"",loaded:!1,data:[]}}},methods:{updateCategories:function(){var e=this;return u()(c.a.mark((function t(){var n;return c.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$axios.get("/categories");case 2:n=t.sent,e.categories.data=n.data.data,e.categories.loaded=!0;case 5:case"end":return t.stop()}}),t)})))()},editPost:function(e){this.$router.push("/moderator/posts/".concat(e.id.replace("p","")))},editCategoryTitle:function(e){var t=this;this.$q.dialog({title:"Редактирование категории",message:"Введите новое заглавие",prompt:{model:e.title,type:"text"},cancel:!0,persistent:!0}).onOk((function(n){t.$axios.patch("/moderator/categories/".concat(e.id),{title:n}).then((function(){t.$q.notify("Изменения сохранены!"),t.updateCategories()}))}))},getParentCategory:function(e){function t(n){if(!n)return null;if(e.is_post){if(n.posts.find((function(t){return t.id===parseInt(e.id.replace("p",""))})))return n;for(var r in n.children){var i=t(n.children[r]);if(i)return i}return null}if(n.children.find((function(t){return t.id===parseInt(e.id)})))return n;for(var a in n.children){var o=t(n.children[a]);if(o)return o}return null}return t({id:null,children:this.categories.data,posts:[]})},moveItem:function(e,t){var n=this;return u()(c.a.mark((function r(){var i,a,o,s;return c.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(i=n.getParentCategory(e),a=e.is_post?i.posts:i.children,o=a.findIndex((function(t){return t.id===parseInt(String(e.id).replace("p",""))})),o+t>=0&&o+t<a.length&&(a[o]=a.splice(o+t,1,a[o])[0]),a.forEach((function(e,t){return e.position=t})),s=a.map((function(e){return{id:e.id,position:e.position}})),!e.is_post){r.next=11;break}return r.next=9,n.$axios.patch("/moderator/posts",s);case 9:r.next=13;break;case 11:return r.next=13,n.$axios.patch("/moderator/categories",s);case 13:n.updateCategories();case 14:case"end":return r.stop()}}),r)})))()},moveItemUp:function(e){return this.moveItem(e,-1)},moveItemDown:function(e){return this.moveItem(e,1)},getListOfCategories:function(e){var t=[];function n(r,i){if(i||(i=1),e&&String(r.id)===String(e))return i--;t.push({value:r.id,label:function(){for(var e="",t=0;t<i;t++)e+="===";return e}()+r.title});for(var a=0;a<r.children.length;a++)n(r.children[a],i+1)}return this.categories.loaded?(this.categories.data.forEach(n),t):[]},editCategoryParent:function(e){var t=this;this.$q.dialog({title:"Редактирование родителя",message:"Выберите нового родителя",options:{type:"radio",model:this.getParentCategory(e).id,items:[{label:"Корень",value:null}].concat(o()(this.getListOfCategories(e.id)))},cancel:!0,persistent:!0}).onOk((function(n){t.$axios.patch("/moderator/categories/".concat(e.id),{parent_id:n}).then((function(){t.$q.notify("Изменения сохранены!"),t.updateCategories()}))}))},createCategory:function(){var e=this;this.$q.dialog({title:"Создание категории",message:"Введите заглавие",prompt:{model:"",type:"text"},cancel:!0,persistent:!0}).onOk((function(t){e.$q.dialog({title:"Создание категории",message:"Выберите родителя",options:{type:"radio",model:null,items:[{label:"Корень",value:null}].concat(o()(e.getListOfCategories()))},cancel:!0,persistent:!0}).onOk(function(){var n=u()(c.a.mark((function n(r){return c.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.storeCategory({title:t,parent_id:r});case 2:n.sent,e.$q.notify("Категория создана!"),e.updateCategories();case 5:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())}))},storeCategory:function(e){var t=this;return u()(c.a.mark((function n(){var r;return c.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.$axios.post("/moderator/categories",e);case 2:return r=n.sent,n.abrupt("return",r);case 4:case"end":return n.stop()}}),n)})))()}},computed:{TreeCategories:function(){function e(t){return{id:t.id,title:t.title,children:[].concat(o()(t.children.map(e)),o()(t.posts.map((function(e){return{id:"p"+e.id,title:e.title,is_post:!0}}))))}}return this.categories.loaded?this.categories.data.map(e):{}}},mounted:function(){this.updateCategories()}},p=d,f=n("2877"),m=n("9989"),g=n("66e5"),h=n("4074"),v=n("0170"),w=n("9c40"),q=n("7f41"),C=n("e7a9"),b=n("0016"),_=n("f20b"),k=n("1c1c"),x=n("7f67"),y=n("eebe"),I=n.n(y),$=Object(f["a"])(p,r,i,!1,null,"5a298a90",null);t["default"]=$.exports;I()($,"components",{QPage:m["a"],QItem:g["a"],QItemSection:h["a"],QItemLabel:v["a"],QBtn:w["a"],QTree:q["a"],QBtnGroup:C["a"],QIcon:b["a"],QBtnDropdown:_["a"],QList:k["a"]}),I()($,"directives",{ClosePopup:x["a"]})}}]);